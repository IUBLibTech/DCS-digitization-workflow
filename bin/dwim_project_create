#!/bin/env python
import activate_venv
import argparse
import yaml
from pathlib import Path
import sys
import logging
import re
from datetime import datetime
import getpass
from dwim.schemas import Schema
from dwim.profiles import load_profile
from dwim.config import load_config
from dwim.project import Project

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--debug", default=False, action="store_true", help="Turn on debugging")
    parser.add_argument("profile", help="digitization entity profile")
    parser.add_argument("id", help="ID of the project")
    args = parser.parse_args()

    logging.basicConfig(level=logging.DEBUG if args.debug else logging.INFO)

    profile = load_profile(args.profile)
    config = load_config()
    
    try: 
        Project(Path(config.project_root), args.id, profile)
        logging.error("Project already exists!")
        exit(1)
    except FileNotFoundError:
        # if the project isn't found, that's actually a good thing.
        pass

    project = Project(Path(config.project_root), args.id, profile, create=True)

    logging.info(f"Project {project.name} has been created at {project.project_root}")




if __name__ == "__main__":
    main()

